stages:
  - test

variables:
  BAZEL_USER_ROOT: ".cache/bazel"

cache: &x86_64_cache
  key: x86_64
  paths:
    - "$bazel-user_root"
  policy: pull-push

debug-test-job:
  stage: test
  script:
    - ./bazelisk-linux-amd64 --output_user_root="$BAZEL_USER_ROOT" test -c dbg //third_party/gtest:gtest_test
  cache:
    <<: *x86_64_cache
    policy: pull

optimized-test-job:
  stage: test
  script:
    - ./bazelisk-linux-amd64 --output_user_root="$BAZEL_USER_ROOT" test -c opt //...
  cache:
    <<: *x86_64_cache
